---
output:
  html_document: default
  pdf_document: default
---
\newpage
\tableofcontents 
\newpage
\listoftables 
\newpage
\listoffigures 
\newpage

```{r Setup, include=FALSE}
# Set your working directory

# Load your packages
#install.packages('readxl')
#install.packages('foreign')
#install.packages('sf')
#install.packages('leaflet')
#install.packages('mapview')
library(readxl)
library(here)
library(tidyverse)
library(lubridate)
library(foreign)
library(dplyr)
library(tidyverse, quietly = TRUE)
library(sf)
library(leaflet)
library(mapview); mapviewOptions(fgb = FALSE)

# Set your ggplot theme
theme_set(theme_minimal())

# Check working directory
here()

# Load your datasets
#Importing processed energy monthly generation data
df_generation_monthly <- read.csv(here("Data/Processed/df_generation_monthly.csv"),
                                  stringsAsFactors = TRUE)
#Importing processed pollutant monthly data 
df_pollutant_monthly <- read.csv(here("Data/Processed/df_pollutant.csv"),
                                  stringsAsFactors = TRUE)

#Importing processed plant location and capacity data
df_plantcapacities_locations <- read.csv(here("Data/Processed/df_plantcapacities_locations.csv"),
                                  stringsAsFactors = TRUE)
#Importing processed pollutant observation stations data
df_station_locations <- read.csv(here("Data/Processed/df_latitude_longitude.csv"),
                                  stringsAsFactors = TRUE)
#Importing state abbreviations 
df_state<- read.csv(here("Data/Processed/df_statename.csv"),
                                  stringsAsFactors = TRUE)

#Setting date columns as date objects
df_generation_monthly$Date <- ymd(df_generation_monthly$Date)
df_pollutant_monthly$Date <- ym(df_pollutant_monthly$Date)

#Setting date columns as date objects
df_generation_monthly$Date <- ymd(df_generation_monthly$Date)
df_pollutant_monthly$Date <- ymd(df_pollutant_monthly$Date)

```


# Rationale and Research Questions
Background 

In the context of escalating global environmental challenges, the shift from traditional fossil fuel-based energy sources to renewable energy has become a focal point in efforts to reduce carbon emissions and combat climate change (Kabeyi et. al, 2022). However, the transition's broader environmental impacts, particularly on air quality, remain less explored. This transition is especially relevant given the increasing global energy demand and the need to meet this demand sustainably.

Significance 

Understanding the relationship between renewable energy generation and air quality is crucial. Renewable energy sources like wind and solar are lauded for their lower environmental impact compared to fossil fuels, which are major contributors to air pollution (UCSUSA, 2018). Air pollution is a significant environmental hazard, affecting human health, ecosystems, and the climate. It is responsible for millions of premature deaths annually and contributes to the occurrence of diseases like asthma, heart disease, and lung cancer (National Geographic, 2023). Therefore, assessing how increased renewable energy generation affects air quality indicators is not just an environmental concern but a public health imperative.

Theoretical Context

The hypothesis underlying this research is that an increase in renewable energy generation leads to a reduction in air pollution. This hypothesis is grounded in the understanding that renewable energy sources, unlike fossil fuels, do not emit pollutants like sulfur dioxide, nitrogen oxides, and particulate matter during electricity generation.


Research Questions

1: What is the relationship between distributed renewable energy generation and the level of air pollution?

This question aims to investigate the correlation between the rise in renewable energy generation and the concentrations of various air pollutants. It seeks to understand whether regions with higher renewable energy output exhibit lower levels of air pollutants.

2: Among air quality indicators (PM10, PM2.5, CO, NO2, and SO2), which display the most significant response to variations in energy generation?

This question delves deeper into identifying which specific pollutants are most responsive to changes in energy generation types. It is crucial for pinpointing the environmental benefits of renewable energy sources and for policy-making aimed at targeted air pollution reduction.
\newpage

# Dataset Information



\newpage

# Exploratory Analysis 
```{r Visualization: Generation}
top_states_renewables2022 <- df_generation_monthly %>% 
  filter(Year == 2022) %>% 
  group_by(State) %>% 
  summarise(NetGeneration = sum(NetGeneration)) %>% 
  mutate(Rank = rank(-NetGeneration)) %>% 
  filter(Rank %in% c(1:10))

#visualizing renewable energy generation over time

#Summarizing monthly data into annual data
df_generation_annual <- df_generation_monthly %>% 
  group_by(Year) %>% 
  summarise(NetGeneration = sum(NetGeneration))

#Plotting out trend for top 10 states
plot.MonthlyGeneration <- df_generation_monthly %>%
  filter(State %in% top_states_renewables2022$State) %>% 
  ggplot(aes(x=Date,
             y=NetGeneration,
             color=State)) +
  geom_line() +
  labs(x="Date",
       y="Monthly Energy Generation (MWh)",
       title="Monthly Renewable Energy Generation per State (MWh)")

print(plot.MonthlyGeneration)

plot.AnnualGeneration <- df_generation_annual %>% 
  ggplot(aes(x=Year,
             y=NetGeneration)) +
  geom_line() +
  labs(x="Year",
       y="Annual Energy Generation (MWh)",
       title="Annual Renewable Energy Generation over time (MWh)")

print(plot.AnnualGeneration)
```

```{r Visualization: Pollutant CO}
# Observe air quality variation among the top 10 states in renewable energy generation
top_states_renewables2022$State
unique(df_pollutant_monthly$State)

df_pollutant_location<-merge(df_pollutant_monthly,df_state,by='State') #add state abbreviation

df_pollutant_top10<-df_pollutant_location %>%
  filter(Abbreviation %in% top_states_renewables2022$State) %>%
  arrange(Date)

#confirm the selection is correct 
top_states_renewables2022$State
unique(df_pollutant_top10$Abbreviation)

unique(df_pollutant_top10$Pollutant)
#CO
df_CO_top10<-df_pollutant_top10 %>%
  filter(Pollutant=="Carbon monoxide")

#PM2.5
df_PM2.5_top10<-df_pollutant_top10 %>%
  filter(Pollutant=="PM2.5 - Local Conditions")

#SO2
df_SO2_top10<-df_pollutant_top10 %>%
  filter(Pollutant=="Sulfur dioxide")

#NO2
df_NO2_top10<-df_pollutant_top10 %>%
  filter(Pollutant=="Nitrogen dioxide (NO2)")

#PM10
df_PM10_top10<-df_pollutant_top10 %>%
  filter(Pollutant=="PM10 Total 0-10um STP")

#plotting trend for top 10 states
plot.PM10<-ggplot(df_PM10_top10, aes(x =Date, y = Mean, color=State)) +
  geom_line()+
  labs(x="Date",y="mg/m\u00B3")+
  ggtitle("PM10 Concentration")+
  theme(plot.title = element_text(hjust = 0.5))
plot.PM10

plot.PM2.5<-ggplot(df_PM2.5_top10, aes(x =Date, y = Mean, color=State)) +
  geom_line()+
  labs(x="Date",y="mg/m\u00B3")+
  ggtitle("PM2.5 Concentration")+
  theme(plot.title = element_text(hjust = 0.5))
plot.PM2.5

plot.CO<-ggplot(df_CO_top10, aes(x =Date, y = Mean, color=State)) +
  geom_line()+
  labs(x="Date",y="Parts per million")+
  ggtitle("Carbon Monoxide Concentration")+
  theme(plot.title = element_text(hjust = 0.5))
plot.CO

plot.SO2<-ggplot(df_SO2_top10, aes(x =Date, y = Mean, color=State)) +
  geom_line()+
  labs(x="Date",y="Parts per million")+
  ggtitle("Sulfur Dioxide Concentration")+
  theme(plot.title = element_text(hjust = 0.5))
plot.SO2

plot.NO2<-ggplot(df_NO2_top10, aes(x =Date, y = Mean, color=State)) +
  geom_line()+
  labs(x="Date",y="Parts per billion")+
  ggtitle("Nitrogen Dioxide Concentration")+
  theme(plot.title = element_text(hjust = 0.5))
plot.NO2

```

```{r Time Series, message=FALSE}
#PM

```

```{r Visualization: Spatial}

#Reading power plant location data into spatial dataframe
df_plantcapacities_locations_sf <- df_plantcapacities_locations %>%
  na.omit() %>% 
  filter(STATE == 'TX') %>% 
  st_as_sf(coords = c('LONG','LAT'), crs=4269)

mapview(df_plantcapacities_locations_sf,
        zcol = 'FUEL',
        cex = 'CAPACITY',
        layer.name = 'Renewable Energy Plant Locations in Texas')


#counties_sf<- st_read(here('Data/Spatial/cb_2018_us_county_20m.shp')) %>% 
#  filter(STATEFP == 48)

#colnames(counties_sf)

#
#st_crs(counties_sf) 


#
#nrow(counties_sf)

#Reveal the extent of this dataset via the st_bbox() function
#st_bbox(counties_sf)

#View the data
#head(counties_sf)

#mapView(counties_sf, zcol = "AWATER")

```


\newpage

# Analysis

```{r}
#Box Plot for Comparing Distributions of a Single Pollutant Across Multiple States:


# PM2.5
ggplot(df_PM2.5_top10, aes(x = State, y = Mean, fill = State)) +
  geom_boxplot() +
  labs(title = "Distribution of PM2.5 Levels Across States",
       x = "State",
       y = "PM2.5 Concentration (µg/m³)") +
  theme_minimal() +
  theme(legend.position = "none")

# CO

ggplot(df_CO_top10, aes(x = State, y = Mean, fill = State)) +
  geom_boxplot() +
  labs(title = "Distribution of CO Levels Across States",
       x = "State",
       y = "CO Concentration (ppm)") +
  theme_minimal() +
  theme(legend.position = "none")

# NO2

ggplot(df_NO2_top10, aes(x = State, y = Mean, fill = State)) +
  geom_boxplot() +
  labs(title = "Distribution of NO2 Levels Across States",
       x = "State",
       y = "NO2 Concentration (ppb)") +
  theme_minimal() +
  theme(legend.position = "none")

# PM10 

ggplot(df_PM10_top10, aes(x = State, y = Mean, fill = State)) +
  geom_boxplot() +
  labs(title = "Distribution of PM10 Levels Across States",
       x = "State",
       y = "PM10 Concentration (µg/m³)") +
  theme_minimal() +
  theme(legend.position = "none")

# SO2

ggplot(df_SO2_top10, aes(x = State, y = Mean, fill = State)) +
  geom_boxplot() +
  labs(title = "Distribution of SO2 Levels Across States",
       x = "State",
       y = "SO2 Concentration (ppb)") +
  theme_minimal() +
  theme(legend.position = "none")


```
# Interpretation of the Boxplots
#it may be redundant, we can decide if we want to keep it or not..

PM2.5 Levels: The distribution of PM2.5 levels varies widely between states. California shows a particularly high range of PM2.5 concentrations with notable outliers, indicating episodes of very poor air quality. It's important to look into the reasons for California's variability, such as wildfires or urban pollution.

CO Levels: CO levels are relatively uniform across the states, with fewer outliers compared to PM2.5. This could indicate a more consistent source of CO pollution, such as traffic, across these states.

NO2 Levels: NO2 levels are somewhat variable, with Illinois showing a higher median concentration. This could be associated with industrial activities or high traffic density.

PM10 Levels: PM10 shows a spread similar to PM2.5, with California again showing high variability and outliers. This suggests common sources of particulate matter affecting both PM10 and PM2.5.

SO2 Levels: The distribution of SO2 is quite tight in most states, except for a few outliers. This pollutant is often associated with industrial processes and the burning of sulfur-containing fuels.

```{r}
library(dplyr)

# df_generation_monthly
top_states <- df_generation_monthly %>%
  group_by(State) %>%
  summarise(TotalGeneration = sum(NetGeneration)) %>%
  top_n(10, TotalGeneration) %>%
  pull(State)

#Time Series Plot for Renewable Energy Generation
ggplot(df_generation_monthly %>% filter(State %in% top_states), 
       aes(x = Date, y = NetGeneration, group = State, color = State)) +
  geom_line() +
  labs(title = "Renewable Energy Generation Over Time in Top 10 States",
       x = "Date",
       y = "Net Generation (MWh)") +
  theme_minimal()



```
# Interpretation 

The line graph above displays the trend of renewable energy generation over time in the top 10 states. We can see that there is a general upward trend in renewable energy generation across all states, indicating increased adoption and capacity over time. California (CA) stands out with a significantly higher generation, especially with a steep increase around 2020. Other states also show growth in renewable energy generation but to varying degrees. For instance, Texas (TX) and Iowa (IA) show notable increases. The variability in generation over time could be influenced by factors like state policies, technological advancements, and investment in renewable energy infrastructure.The overall increasing trend aligns with global efforts to transition to cleaner energy sources to reduce reliance on fossil fuels and combat climate change.

```{r}
# Check unique states in both datasets
unique(df_generation_monthly$State)
unique(df_pollutant_monthly$State)

```

```{r}
state_abbreviations <- c(AL = "Alabama", AK = "Alaska", AZ = "Arizona", AR = "Arkansas", CA = "California", 
                         CO = "Colorado", CT = "Connecticut", DE = "Delaware", FL = "Florida", GA = "Georgia", 
                         HI = "Hawaii", ID = "Idaho", IL = "Illinois", IN = "Indiana", IA = "Iowa", 
                         KS = "Kansas", KY = "Kentucky", LA = "Louisiana", ME = "Maine", MD = "Maryland", 
                         MA = "Massachusetts", MI = "Michigan", MN = "Minnesota", MS = "Mississippi", MO = "Missouri", 
                         MT = "Montana", NE = "Nebraska", NV = "Nevada", NH = "New Hampshire", NJ = "New Jersey", 
                         NM = "New Mexico", NY = "New York", NC = "North Carolina", ND = "North Dakota", 
                         OH = "Ohio", OK = "Oklahoma", OR = "Oregon", PA = "Pennsylvania", RI = "Rhode Island", 
                         SC = "South Carolina", SD = "South Dakota", TN = "Tennessee", TX = "Texas", UT = "Utah", 
                         VT = "Vermont", VA = "Virginia", WA = "Washington", WV = "West Virginia", WI = "Wisconsin", 
                         WY = "Wyoming")


df_pollutant_monthly$State <- sapply(df_pollutant_monthly$State, function(x) {
  name <- state_abbreviations[which(state_abbreviations == x)]
  if (length(name) == 0) NA else names(name)
})


df_merged_top_states <- merge(df_generation_monthly %>% filter(State %in% top_states), 
                              df_pollutant_monthly %>% filter(State %in% top_states), 
                              by = c("State", "Date"))

str(df_merged_top_states)

```
```{r}
# Creating a list of unique pollutants in our dataset
unique_pollutants <- unique(df_merged_top_states$Pollutant)

# Creating a list to store the plots
scatter_plots <- list()

# Looping through each unique pollutant and creating a scatter plot
for (pollutant in unique_pollutants) {
  plot_data <- df_merged_top_states[df_merged_top_states$Pollutant == pollutant, ]
  
  plot <- ggplot(plot_data, aes(x = NetGeneration, y = Mean, color = State)) +
    geom_point() +
    labs(title = paste("Net Generation vs.", pollutant),
         x = "Net Generation",
         y = "Pollutant Concentration",
         color = "State") +
    theme_minimal()
  
  scatter_plots[[pollutant]] <- plot
}

# Printing the scatter plots
scatter_plots


```
#Interpretation

PM2.5 and Net Generation: There doesn't seem to be a clear relationship between net generation and PM2.5 levels. While some states with higher net generation have lower PM2.5 levels, the data is scattered, suggesting other factors may be at play in determining PM2.5 concentrations.

PM10 and Net Generation: Similar to PM2.5, the PM10 concentrations do not show a clear trend in relation to net generation. There is significant scatter across all levels of net generation.

Sulfur Dioxide (SO2) and Net Generation: The plot for SO2 shows a dense clustering of lower SO2 levels at higher net generation, which might indicate that higher renewable energy generation could be associated with lower SO2 concentrations.

Nitrogen Dioxide (NO2) and Net Generation: The scatter plot for NO2 presents a wide distribution of pollutant concentrations across the net generation axis, indicating no strong correlation between the two.

Carbon Monoxide (CO) and Net Generation: The CO levels are spread across the generation axis, but there is a noticeable cluster of lower CO concentrations at higher levels of net generation.

So, in conclusion, upon reviewing the scatter plots for PM2.5, PM10, NO2, and SO2 in relation to renewable energy generation, it is the scatter plots for Sulfur Dioxide (SO2) and Carbon Monoxide (CO) that show some indication of a relationship. For SO2, higher levels of renewable energy generation seem to correspond with a clustering of lower pollutant concentrations. Similarly, the scatter plot for CO also shows a clustering of data points towards lower CO levels as net generation increases. These observations suggest an inverse relationship where increased renewable energy generation could be associated with decreased emissions of SO2 and CO, which are pollutants typically associated with the combustion of fossil fuels.



```{r}



```

## Question 1: 
What is the relationship between distributed renewable energy generation and the level of air pollution?



## Question 2: 
Among air quality indicators (PM10, PM2.5, CO, NO2, and SO2), which display the most significant response to variations in energy generation?



\newpage

# Summary and Conclusions


\newpage

# References
Kabeyi, Moses Jeremiah Barasa, and Oludolapo Akanni Olanrewaju. ‘Sustainable Energy Transition for Renewable and Low Carbon Grid Electricity Generation and Supply’. Frontiers in Energy Research, vol. 9, 2022. Frontiers, https://www.frontiersin.org/articles/10.3389/fenrg.2021.743114.

Environmental Impacts of Renewable Energy Technologies | Union of Concerned Scientists. https://www.ucsusa.org/resources/environmental-impacts-renewable-energy-technologies. Accessed 6 Dec. 2023.

Air Pollution. https://education.nationalgeographic.org/resource/air-pollution. Accessed 6 Dec. 2023.
